apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: roboshop-ebs-sc # all should be lower case
reclaimPolicy: Retain
provisioner: ebs.csi.aws.com
volumeBindingMode: WaitForFirstConsumer


# install drivers
# kubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csi-driver/deploy/kubernetes/overlays/stable/?ref=release-1.53"
# give permission for ebs in iam for instance

# debuggin - if statefulset does not start error is SC,volumes,volume mounts check
#  kubectl describe statefulset mongodb -n roboshop

#if we do not specify iam permission for cluster nodes volume wont be created and will be in pending state for pvc

# ğ—§ğ—¿ğ—¼ğ˜‚ğ—¯ğ—¹ğ—²ğ˜€ğ—µğ—¼ğ—¼ğ˜ğ—¶ğ—»ğ—´ ğ—˜ğ—•ğ—¦ ğ—–ğ—¦ğ—œ ğ——ğ—¿ğ—¶ğ˜ƒğ—²ğ—¿ ğ—®ğ—»ğ—± ğ—¦ğ˜ğ—®ğ˜ğ—²ğ—³ğ˜‚ğ—¹ğ—¦ğ—²ğ˜ ğ—œğ˜€ğ˜€ğ˜‚ğ—²ğ˜€ ğ—¶ğ—» ğ—ğ˜‚ğ—¯ğ—²ğ—¿ğ—»ğ—²ğ˜ğ—²ğ˜€: ğ—ğ—²ğ˜† ğ—–ğ—¼ğ—ºğ—ºğ—®ğ—»ğ—±ğ˜€ ğ—³ğ—¼ğ—¿ ğ——ğ—²ğ—¯ğ˜‚ğ—´ğ—´ğ—¶ğ—»ğ—´

# ğ—–ğ—¼ğ—ºğ—ºğ—¼ğ—» ğ—˜ğ—¿ğ—¿ğ—¼ğ—¿ğ˜€:

# ğ—¦ğ˜ğ—®ğ˜ğ—²ğ—³ğ˜‚ğ—¹ğ—¦ğ—²ğ˜ ğ—˜ğ—¿ğ—¿ğ—¼ğ—¿ğ˜€:

# Â Â â€¢ Pod Pending â†’ Describe StatefulSet and PVC to check binding issues.
# Â Â â€¢ Volume Attachment Failure â†’ Check Pod logs for volume attachment issues.
# Â Â â€¢ Container Crashing â†’ Check Pod logs for application errors or misconfigurations.

# ğ—£ğ—©ğ—– ğ—˜ğ—¿ğ—¿ğ—¼ğ—¿ğ˜€:

# Â Â â€¢ PVC Pending â†’ Describe PVC to check binding issues, and ensure the StorageClass is correct.
# Â Â â€¢ PVC Not Bound â†’ Ensure dynamic provisioning is working and that the StorageClass is valid.
# Â Â â€¢ VolumeAttachment Failure â†’ Check EBS CSI controller logs for attachment failures.

# ğ—¦ğ˜ğ—¼ğ—¿ğ—®ğ—´ğ—²ğ—–ğ—¹ğ—®ğ˜€ğ˜€ ğ—˜ğ—¿ğ—¿ğ—¼ğ—¿ğ˜€:

# Â Â â€¢ Invalid StorageClass â†’ Ensure the StorageClass is correctly defined and associated with the correct provisioner.

# ğ—™ğ—œğ—«ğ—˜ğ—¦:

# 1. Install AWS EBS CSI Driver
# kubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csi-driver/deploy/kubernetes/overlays/stable/?ref=release-1.53"
# 2. Ensure IAM Permissions for EBS
# Attach the EBS CSI policy to your EC2 instance IAM role for EBS access.
# 3. Debugging StatefulSet and PVC Issues

# Describe StatefulSet:
# ğ—¸ğ˜‚ğ—¯ğ—²ğ—°ğ˜ğ—¹ ğ—±ğ—²ğ˜€ğ—°ğ—¿ğ—¶ğ—¯ğ—² ğ˜€ğ˜ğ—®ğ˜ğ—²ğ—³ğ˜‚ğ—¹ğ˜€ğ—²ğ˜ <ğ˜€ğ˜ğ—®ğ˜ğ—²ğ—³ğ˜‚ğ—¹ğ˜€ğ—²ğ˜-ğ—»ğ—®ğ—ºğ—²> -ğ—» <ğ—»ğ—®ğ—ºğ—²ğ˜€ğ—½ğ—®ğ—°ğ—²>

# Check PVC Status:
# ğ—¸ğ˜‚ğ—¯ğ—²ğ—°ğ˜ğ—¹ ğ—´ğ—²ğ˜ ğ—½ğ˜ƒğ—° -ğ—» <ğ—»ğ—®ğ—ºğ—²ğ˜€ğ—½ğ—®ğ—°ğ—²>

# Describe PVC if Pending:
# ğ—¸ğ˜‚ğ—¯ğ—²ğ—°ğ˜ğ—¹ ğ—±ğ—²ğ˜€ğ—°ğ—¿ğ—¶ğ—¯ğ—² ğ—½ğ˜ƒğ—° <ğ—½ğ˜ƒğ—°-ğ—»ğ—®ğ—ºğ—²> -ğ—» <ğ—»ğ—®ğ—ºğ—²ğ˜€ğ—½ğ—®ğ—°ğ—²>

# Check StorageClass:
# ğ—¸ğ˜‚ğ—¯ğ—²ğ—°ğ˜ğ—¹ ğ—´ğ—²ğ˜ ğ˜€ğ˜ğ—¼ğ—¿ğ—®ğ—´ğ—²ğ—°ğ—¹ğ—®ğ˜€ğ˜€

# 4. Check EBS CSI Controller Logs for IAM Issues
# ğ—¸ğ˜‚ğ—¯ğ—²ğ—°ğ˜ğ—¹ ğ—¹ğ—¼ğ—´ğ˜€ <ğ—½ğ—¼ğ—±-ğ—¶ğ—±> -ğ—» ğ—¸ğ˜‚ğ—¯ğ—²-ğ˜€ğ˜†ğ˜€ğ˜ğ—²ğ—º


# These are the commands you can use to troubleshoot the EBS CSI driver and StatefulSet issues in your Kubernetes setup.